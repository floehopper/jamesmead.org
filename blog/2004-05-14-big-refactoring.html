<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Big Refactoring - James Mead</title>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="keywords" content="refactoring " />
    <meta name="author" content= "James Mead" />

    <meta name="verify-v1" content="H0rIfyqCDW+br6ieZtuZ+Hnt3ii3FpF22qFYjZmO+3E=" />
    <meta name="y_key" content="5f5b0de20991e0c2" />
    <meta name="msvalidate.01" content="5D5476B4F9F70AAFE14D519093E3FFA8" />

    <link href="/images/favicon.gif" rel="icon" type="image/gif" />

    <link href="/stylesheets/yui/3.18.1/cssreset-min.css" rel="stylesheet" /><link href="/stylesheets/yui/3.18.1/cssfonts-min.css" rel="stylesheet" /><link href="/stylesheets/yui/3.18.1/cssbase-min.css" rel="stylesheet" />

    <link href="/stylesheets/site.css" rel="stylesheet" />

    <link href="/stylesheets/prettify/prettify.css" rel="stylesheet" />
    <script src="/javascripts/prettify/prettify.js" defer="defer"></script>

    <link rel="alternate" type="application/atom+xml" title="Atom" href="http://feeds.jamesmead.org/floehopper-blog" />

    <link rel="webmention" href="https://webmention.io/jamesmead.org/webmention" />

    <link rel="prev" href="/blog/2004-05-14-unit-tests-can-100-coverage-be-a-bad-thing" />
    <link rel="next" href="/blog/2006-02-22-gadget-reviews" />
    <link rel="first" href="/blog/2004-05-14-unit-tests-can-100-coverage-be-a-bad-thing" />
    <link rel="last" href="/blog/2022-11-01-mocha-v2-release" />
    <link rel="index" href="/blog" />

  </head>
  <body class="blog blog_2004-05-14-big-refactoring" onload="prettyPrint()">
    <div id="doc">
      <div class="skip-links">
        <a href="#bd">Skip to main content</a>
      </div>

      <header id="hd">
        <nav aria-label="Primary">
          <a href="/">Home</a>
          &middot;
          <a href="/blog/">Blog</a>
          &middot;
          <a href="/adventures/">Adventures</a>
          &middot;
          <a href="/notes/">Notes</a>
          &middot;
          <a href="/talks/">Talks</a>
          &middot;
          <a href="/projects/">Projects</a>
        </nav>
      </header>

      <main id="bd">
          <article class="h-entry">
    <header>
      <h1 class="p-name">Big Refactoring</h1>
    </header>

    <section class="e-content">
      <p>When attempting a pervasive <a href="http://www.refactoring.com/">refactoring</a> in a large system, it&#8217;s tempting to do the full refactoring in a localized part of the system and leave other parts for another day &#8211; perhaps because you run out of time or get bored. You can assuage your conscience by marking the remaining places with todo comments or deprecating old methods.</p>
<p>But this approach has the disadvantage of leaving the system in an inconsistent state with parts of it working one way and other parts working another way. This isn&#8217;t so bad in itself, but when it occurs multiple times without the inconsistency being removed, it can lead to a very confusing codebase.</p>
<p>I think it&#8217;s much better to break the refactoring down into several smaller steps and then attempt to apply each step to the whole system one at a time. This means that you&#8217;re able to build and run tests after each step. Approaching the refactoring this way may well give you deeper insights and lead you to a better end result, because it gives you more freedom to change direction mid-course.</p>
<p>This is one application of a personal practice which I try to follow &#8211; try not to get &#8220;too far&#8221; from a <a href="http://junit.sourceforge.net/">JUnit</a> <a href="http://junit.sourceforge.net/doc/testinfected/IMG00001.GIF">green bar</a>. By which I mean &#8211; don&#8217;t have too many tests failing for too long. Ideally if you have multiple tests failing, they should be failing for a single reason.</p>
<p>If you can&#8217;t work out how to do the refactoring in lots of small steps, try a <a href="http://www.extremeprogramming.org/rules/spike.html">spike</a> &#8211; try out some large steps or other ideas without worrying about breaking tests. But then throw away the changes and do the refactoring in small steps keeping the tests running, making use of the insight you&#8217;ve gained from your &#8220;spike&#8221;. If you still can&#8217;t work out how to do the refactoring in small steps, you probably shouldn&#8217;t be doing it!</p>
<p>Update: I noticed that Nat Pryce has <a href="http://nat.truemesh.com/archives/000250.html">blogged</a> on a similar theme.</p>
    </section>

    <footer>
      <p class="metadata">
        Published by <a class="p-author h-card" href="https://jamesmead.org/">James Mead</a> on <a class="u-url" href="https://jamesmead.org/blog/2004-05-14-big-refactoring"><time class="dt-published" datetime="2004-05-14T14:36:45+00:00">14 May 2004 at 14:36</time></a>
      </p>
      <div class="webmentions" data-webmentions="https://jamesmead.org/blog/2004-05-14-big-refactoring">
  <template id="webmention-template">
    <li class="webmention">
      <div>
        <a class="author">
          <span class="author-name"></span>
        </a>
        <a class="action"></a>
      </div>
      <div class="content"></div>
    </li>
  </template>
</div>

<script src="/javascripts/webmentions.js" type="text/javascript" charset="utf-8" defer></script>

    </footer>
  </article>


          <nav id="navigation" aria-label="Inter-article">
      <a href="/blog/2004-05-14-unit-tests-can-100-coverage-be-a-bad-thing" class="previous">&lt; Unit tests - Can 100% coverage be a bad thing?</a>
      <a href="/blog/2006-02-22-gadget-reviews" class="next">Gadget Reviews &gt;</a>
  </nav>

      </main>

      <footer id="ft">
        <nav aria-label="Footer">
          <a href="/contact">Contact</a>
          &middot;
          <a href="/history">History</a>
          &middot;
          <a href="/colophon">Colophon</a>
          &middot;
          <a href="/links">Links</a>
        </nav>
        <div id="indieweb-ring">
          <a href="https://xn--sr8hvo.ws/%F0%9F%93%BF%F0%9F%8C%91%F0%9F%A6%82/previous">‚Üê</a>
          An IndieWeb Webring üï∏üíç
          <a href="https://xn--sr8hvo.ws/%F0%9F%93%BF%F0%9F%8C%91%F0%9F%A6%82/next">‚Üí</a>
        </div>
        <p id="creative-commons" xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" class="license-text">
          This work by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="jamesmead.org">James Mead</a> is licensed under
          <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0
            <img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" loading="lazy" alt="Creative Commons logo" />
            <img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" loading="lazy" alt="Creative Commons Attribution icon" />
            <img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" loading="lazy" alt="Creative Commons ShareAlike icon" />
          </a>
        </p>
      </footer>
    </div>
  </body>
</html>
