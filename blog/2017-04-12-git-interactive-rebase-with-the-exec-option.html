<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Git interactive rebase with the exec option - James Mead</title>

    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta name="description" content="How to detect accidental reintroduction of renamed classes or variables" />
    <meta name="author" content= "James Mead" />

    <meta name="verify-v1" content="H0rIfyqCDW+br6ieZtuZ+Hnt3ii3FpF22qFYjZmO+3E=" />
    <meta name="y_key" content="5f5b0de20991e0c2" />
    <meta name="msvalidate.01" content="5D5476B4F9F70AAFE14D519093E3FFA8" />

    <link href="/images/favicon.gif" rel="icon" type="image/gif" />

    <link href="/stylesheets/yui/3.18.1/cssreset-min.css" rel="stylesheet" /><link href="/stylesheets/yui/3.18.1/cssfonts-min.css" rel="stylesheet" /><link href="/stylesheets/yui/3.18.1/cssbase-min.css" rel="stylesheet" />

    <link href="/stylesheets/site.css" rel="stylesheet" />

    <link href="/stylesheets/prettify/prettify.css" rel="stylesheet" />
    <script src="/javascripts/prettify/prettify.js" defer="defer"></script>

    <link rel="alternate" type="application/atom+xml" title="Atom" href="http://feeds.jamesmead.org/floehopper-blog" />

    <link rel="webmention" href="https://webmention.io/jamesmead.org/webmention" />

    <link rel="prev" href="/blog/2017-04-12-site-history-update" />
    <link rel="next" href="/blog/2018-09-06-organisation-specific-git-config" />
    <link rel="first" href="/blog/2004-05-14-unit-tests-can-100-coverage-be-a-bad-thing" />
    <link rel="last" href="/blog/2022-05-18-how-to-backup-google-drive-to-s3-using-the-aws-cdk" />
    <link rel="index" href="/blog" />

  </head>
  <body class="blog blog_2017-04-12-git-interactive-rebase-with-the-exec-option" onload="prettyPrint()">
    <div id="doc">
      <div class="skip-links">
        <a href="#bd">Skip to main content</a>
      </div>

      <header id="hd">
        <nav aria-label="Primary">
          <a href="/">Home</a>
          &middot;
          <a href="/blog/">Blog</a>
          &middot;
          <a href="/notes/">Notes</a>
          &middot;
          <a href="/talks/">Talks</a>
          &middot;
          <a href="/projects/">Projects</a>
        </nav>
      </header>

      <main id="bd">
          <article class="h-entry">
    <header>
      <h1 class="p-name">Git interactive rebase with the exec option</h1>
        <h2 class="p-summary">How to detect accidental reintroduction of renamed classes or variables</h2>
    </header>

    <section class="e-content">
      <p>Recently we've been doing a lot of refactoring in GDS' <a href="https://github.com/alphagov/manuals-publisher/">manuals-publisher</a> application. With three of us working on the codebase at the same time and significant renames occurring across the application, it's been tricky to avoid merge conflicts when rebasing our branches.</p>

<p>One tactic we use to help avoid this problem is to ensure that each commit is atomic, i.e. all the tests pass after each commit. This means that when you're rebasing you can use the tests as a check that you've resolved conflicts successfully. A simple way to check this for a branch is to use a command like the following:</p>

<pre><code>git rebase --interactive master --exec rake
</code></pre>

<p>This replays all your commits running the tests after each of them. If the tests fail for any of them, the interactive rebase halts and allows you to put things right before continuing.</p>

<p>It's worth noting that you can use as many <code>exec</code> options as you like and you can use any command you like as long as it returns a non-zero exit code when you want the interactive rebase to stop. With this in mind, I've recently taken to using a <code>grep</code> command inside an <code>exec</code> option to catch the accidental reintroduction of code that's been renamed.</p>

<p>For example, if I know that the class <code>SpecialistDocument</code> has been renamed to <code>Section</code> in <code>master</code> and I'm rebasing my branch against <code>master</code>, I can use the following command to ensure that <code>SpecialistDocument</code> hasn't been accidentally reintroduced in any of the commits:</p>

<pre><code>git rebase --interactive master --exec "! grep -R SpecialistDocument *" --exec rake
</code></pre>

<p>Note that the <code>!</code> inverts the exit code, so that the command as a whole fails if the pattern <em>is</em> found in any file thereby stopping the interactive rebase at that point.</p>

<p>I also did something similar to check that my commit notes weren't accidentally still referencing the old class name:</p>

<pre><code>git rebase --interactive master --exec "! git show | grep SpecialistDocument"
</code></pre>


    </section>

    <footer>
      <p class="metadata">
        Published by <a class="p-author h-card" href="https://jamesmead.org/">James Mead</a> on <a class="u-url" href="https://jamesmead.org/blog/2017-04-12-git-interactive-rebase-with-the-exec-option"><time class="dt-published" datetime="2017-04-12T15:11:00+00:00">12 Apr 2017 at 15:11</time></a>
      </p>
      <div class="webmentions" data-webmentions="https://jamesmead.org/blog/2017-04-12-git-interactive-rebase-with-the-exec-option">
  <template id="webmention-template">
    <li class="webmention">
      <div>
        <a class="author">
          <span class="author-name"></span>
        </a>
        <a class="action"></a>
      </div>
      <div class="content"></div>
    </li>
  </template>
</div>

<script src="/javascripts/webmentions.js" type="text/javascript" charset="utf-8" defer></script>

    </footer>
  </article>


          <nav id="navigation" aria-label="Inter-article">
      <a href="/blog/2017-04-12-site-history-update" class="previous">&lt; Site history update</a>
      <a href="/blog/2018-09-06-organisation-specific-git-config" class="next">Organisation-specific git config &gt;</a>
  </nav>

      </main>

      <footer id="ft">
        <nav style="float: left" aria-label="Footer">
          <a href="/contact">Contact</a>
          &middot;
          <a href="/history">History</a>
          &middot;
          <a href="/colophon">Colophon</a>
          &middot;
          <a href="/links">Links</a>
        </nav>
        <div style="float: right">
          <a href="https://xn--sr8hvo.ws/%F0%9F%93%BF%F0%9F%8C%91%F0%9F%A6%82/previous">‚Üê</a>
          An IndieWeb Webring üï∏üíç
          <a href="https://xn--sr8hvo.ws/%F0%9F%93%BF%F0%9F%8C%91%F0%9F%A6%82/next">‚Üí</a>
        </div>
        <p style="clear: both" xmlns:dct="http://purl.org/dc/terms/" xmlns:cc="http://creativecommons.org/ns#" class="license-text">
          This work by <a rel="cc:attributionURL dct:creator" property="cc:attributionName" href="jamesmead.org">James Mead</a> is licensed under
          <a rel="license" href="https://creativecommons.org/licenses/by-sa/4.0">CC BY-SA 4.0
            <img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" loading="lazy" alt="Creative Commons logo" />
            <img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" loading="lazy" alt="Creative Commons Attribution icon" />
            <img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/sa.svg?ref=chooser-v1" loading="lazy" alt="Creative Commons ShareAlike icon" />
          </a>
        </p>
      </footer>
    </div>
  </body>
</html>
